/********************************************************************************
 * Copyright (C) 2024 Sanyam IDE contributors.
 *
 * This program and the accompanying materials are made available under the
 * terms of the MIT License, which is available in the project root.
 *
 * SPDX-License-Identifier: MIT
 ********************************************************************************/

/* ============================================
   Sprotty Diagram Styles
   ============================================ */

/* Main diagram container */
.sanyam-diagram {
    width: 100%;
    height: 100%;
    overflow: hidden;
}

.sanyam-diagram svg {
    width: 100%;
    height: 100%;
}

/* ============================================
   Sprotty Container Styles
   ============================================ */

/* Sprotty visible container - must fill available space */
.sanyam-diagram-svg-container {
    width: 100%;
    height: 100%;
    position: relative; /* Required for absolute positioning of UI extensions (tool palette, minimap) */
}

/* ============================================
   Embedded Diagram Toolbar (FR-006)
   ============================================ */

.sanyam-diagram-embedded-toolbar {
    display: flex;
    align-items: center;
    gap: 2px;
    padding: 4px 8px;
    background-color: var(--theia-editorGroupHeader-tabsBackground, #252526);
    border-bottom: 1px solid var(--theia-editorGroupHeader-tabsBorder, #454545);
    flex-shrink: 0;
    overflow-x: auto;
    z-index: 10;
}

.sanyam-diagram-embedded-toolbar::-webkit-scrollbar {
    height: 2px;
}

.sanyam-diagram-toolbar-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 26px;
    height: 26px;
    border: none;
    border-radius: 4px;
    background-color: transparent;
    color: var(--theia-foreground, #cccccc);
    cursor: pointer;
    padding: 0;
    flex-shrink: 0;
}

.sanyam-diagram-toolbar-button:hover {
    background-color: var(--theia-toolbar-hoverBackground, rgba(90, 93, 94, 0.31));
}

.sanyam-diagram-toolbar-button:active {
    background-color: var(--theia-toolbar-activeBackground, rgba(99, 102, 103, 0.31));
}

.sanyam-diagram-toolbar-button span {
    font-size: 14px;
}

.sanyam-diagram-toolbar-separator {
    width: 1px;
    height: 18px;
    background-color: var(--theia-editorGroupHeader-tabsBorder, #454545);
    margin: 0 4px;
    flex-shrink: 0;
}

/* ============================================
   Floating Mini-Toolbar (bottom-left of canvas)
   ============================================ */

.sanyam-diagram-floating-toolbar {
    position: absolute;
    bottom: 16px;
    left: 16px;
    display: flex;
    flex-direction: column;
    gap: 2px;
    padding: 4px;
    background-color: var(--theia-editorWidget-background, rgba(37, 37, 38, 0.85));
    border: 1px solid var(--theia-editorWidget-border, #454545);
    border-radius: 6px;
    box-shadow: 0 2px 8px var(--theia-widget-shadow, rgba(0, 0, 0, 0.36));
    z-index: 90;
    pointer-events: auto;
    backdrop-filter: blur(4px);
}

.sanyam-diagram-floating-toolbar .sanyam-diagram-toolbar-button {
    width: 28px;
    height: 28px;
}

.sanyam-diagram-floating-toolbar .sanyam-diagram-toolbar-button span {
    font-size: 16px;
}

/* Light theme adjustments */
.theia-light .sanyam-diagram-floating-toolbar {
    background-color: var(--theia-editorWidget-background, rgba(255, 255, 255, 0.9));
    border-color: var(--theia-editorWidget-border, #c8c8c8);
}

/* Ensure diagram container uses flex column layout for toolbar + canvas */
.sanyam-diagram-container {
    display: flex;
    flex-direction: column;
    width: 100%;
    height: 100%;
    position: relative;
}

.sanyam-diagram-container .sanyam-diagram-svg-container {
    flex: 1;
    min-height: 0;
}

/* ============================================
   Layout Pending State (suppress initial jarring)
   ============================================ */

/* During layout-pending, hide the SVG content but keep the container visible
   so the canvas background pattern and progress bar remain visible. */
.sanyam-diagram-svg-container.layout-pending > svg {
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
}

/* Also disable all animations/transitions within the SVG during layout */
.sanyam-diagram-svg-container.layout-pending > svg * {
    transition: none !important;
    animation: none !important;
}

/* ============================================
   Diagram Loading Progress Bar
   ============================================ */

.sanyam-diagram-progress-bar {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 3px;
    z-index: 100;
    overflow: hidden;
    background-color: transparent;
}

.sanyam-diagram-progress-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 30%;
    height: 100%;
    background-color: var(--theia-focusBorder, #007fd4);
    animation: sanyam-progress-indeterminate 1.5s ease-in-out infinite;
}

@keyframes sanyam-progress-indeterminate {
    0% {
        left: -30%;
    }
    100% {
        left: 100%;
    }
}

.sanyam-diagram-progress-bar.hidden {
    display: none;
}

/* Disable progress bar animation for users who prefer reduced motion */
@media (prefers-reduced-motion: reduce) {
    .sanyam-diagram-progress-bar::after {
        animation: none;
        left: 0;
        width: 100%;
        opacity: 0.5;
    }
}

/* Smooth fade-in when layout completes */
.sanyam-diagram-svg-container > svg {
    visibility: visible;
    opacity: 1;
    transition: opacity 0.15s ease-out;
}

/* Starting state for fade-in after layout completes */
.sanyam-diagram-svg-container.layout-complete > svg {
    opacity: 0;
    visibility: visible;
}

/* Animate to full opacity */
.sanyam-diagram-svg-container.layout-complete.layout-reveal > svg {
    opacity: 1;
}

/* Disable animation for users who prefer reduced motion */
@media (prefers-reduced-motion: reduce) {
    .sanyam-diagram-svg-container > svg {
        transition: none;
    }
    .sanyam-diagram-svg-container.layout-complete > svg {
        opacity: 1;
    }
}

/* SVG element created by Sprotty - fill container */
.sanyam-diagram-svg-container > svg.sprotty-graph {
    width: 100%;
    height: 100%;
    display: block;
}

/* ============================================
   Sprotty Default Overrides
   ============================================ */

/* Graph/canvas background - transparent to show container's pattern background */
.sprotty-graph {
    background-color: transparent !important;
    background-image: none !important;
}

/* ============================================
   Diagram Background Patterns (Preference-driven)
   ============================================ */

/* CSS custom properties for diagram backgrounds - set via JavaScript preferences */
.sanyam-diagram-svg-container {
    --diagram-bg-color: var(--theia-sanyam-diagram-background, var(--theia-editor-background, #1e1e1e));
    --diagram-pattern-opacity: 0.3;
    --diagram-dots-color: var(--theia-sanyam-diagram-gridColor, rgba(128, 128, 128, 0.3));
    --diagram-dots-size: 1px;
    --diagram-dots-spacing: 20px;
    --diagram-grid-color: var(--theia-sanyam-diagram-gridColor, rgba(128, 128, 128, 0.3));
    --diagram-grid-size: 20px;
}

/* No background pattern - solid color */
.sanyam-diagram-svg-container.bg-none {
    background-color: var(--diagram-bg-color);
    background-image: none;
}

/* Dots pattern background */
.sanyam-diagram-svg-container.bg-dots {
    background-color: var(--diagram-bg-color);
    background-image: radial-gradient(
        circle,
        var(--diagram-dots-color) var(--diagram-dots-size),
        transparent var(--diagram-dots-size)
    );
    background-size: var(--diagram-dots-spacing) var(--diagram-dots-spacing);
    background-position: 0 0;
}

/* Grid pattern background */
.sanyam-diagram-svg-container.bg-grid {
    background-color: var(--diagram-bg-color);
    background-image:
        linear-gradient(var(--diagram-grid-color) 1px, transparent 1px),
        linear-gradient(90deg, var(--diagram-grid-color) 1px, transparent 1px);
    background-size: var(--diagram-grid-size) var(--diagram-grid-size);
    background-position: 0 0;
}

/* Custom image background - uses pseudo-element for opacity control */
.sanyam-diagram-svg-container.bg-image {
    background-color: var(--diagram-bg-color);
    position: relative;
}

/* Image overlay with opacity - uses ::before pseudo-element */
.sanyam-diagram-svg-container.bg-image::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: var(--diagram-image-url);
    background-repeat: repeat;
    background-size: auto;
    background-position: 0 0;
    opacity: var(--diagram-pattern-opacity, 0.3);
    pointer-events: none;
    z-index: 0;
}

/* Ensure Sprotty SVG is above the image overlay */
.sanyam-diagram-svg-container.bg-image > svg.sprotty-graph {
    position: relative;
    z-index: 1;
}

/* High contrast theme adjustments */
.theia-hcDark .sanyam-diagram-svg-container {
    --diagram-dots-color: var(--theia-sanyam-diagram-gridColor, var(--theia-contrastBorder, rgba(111, 195, 223, 0.4)));
    --diagram-grid-color: var(--theia-sanyam-diagram-gridColor, var(--theia-contrastBorder, rgba(111, 195, 223, 0.3)));
}

.theia-hcLight .sanyam-diagram-svg-container {
    --diagram-dots-color: var(--theia-sanyam-diagram-gridColor, var(--theia-contrastBorder, rgba(15, 74, 133, 0.4)));
    --diagram-grid-color: var(--theia-sanyam-diagram-gridColor, var(--theia-contrastBorder, rgba(15, 74, 133, 0.3)));
}

/* ============================================
   Shape-based Node Styling (SanyamNodeView)
   ============================================ */

/* Base node shape styling - applies to all shapes */
.sprotty-node {
    fill: var(--theia-textCodeBlock-background, #2d2d30);
    stroke: var(--theia-foreground, #cccccc);
    stroke-width: 1px;
}

/* Rectangle shape */
.sanyam-shape-rectangle {
    fill: var(--theia-textCodeBlock-background, #2d2d30);
}

/* Rounded rectangle shape */
.sanyam-shape-rounded {
    fill: var(--theia-textCodeBlock-background, #2d2d30);
}

/* Ellipse shape */
.sanyam-shape-ellipse {
    fill: var(--theia-editor-background, #1e1e1e);
}

/* Diamond shape */
.sanyam-shape-diamond {
    fill: var(--theia-dropdown-background, #3c3c3c);
}

/* Hexagon shape */
.sanyam-shape-hexagon {
    fill: var(--theia-activityBar-background, #333333);
}

/* Pill shape */
.sanyam-shape-pill {
    fill: var(--theia-button-background, #0e639c);
}

/* Selection and hover states for all shapes */
.sprotty-node.selected {
    stroke: var(--theia-focusBorder, #007fd4) !important;
    stroke-width: 2px !important;
}

.sprotty-node.mouseover {
    stroke: var(--theia-list-hoverForeground, #ffffff);
    filter: brightness(1.1);
}

/* Default node styling - Sprotty's RectangularNodeView (fallback)
 * Note: The rect element ITSELF has the sprotty-node class, not a parent g
 */
rect.sprotty-node {
    fill: var(--theia-textCodeBlock-background, #2d2d30) !important;
    stroke: var(--theia-foreground, #cccccc) !important;
    stroke-width: 1px !important;
}

/* Circular nodes (ports) */
circle.sprotty-node,
circle.sprotty-port {
    fill: var(--theia-editor-background, #2d2d30);
    stroke: var(--theia-foreground, #cccccc);
    stroke-width: 1px;
}

/* Default edge styling - Sprotty's PolylineEdgeView */
.sprotty-edge path,
.sprotty-edge line {
    fill: none !important;
    stroke: var(--theia-foreground, #cccccc) !important;
    stroke-width: 1px !important;
}

/* Default label styling - text element has sprotty-label class */
text.sprotty-label {
    fill: var(--theia-foreground, #cccccc) !important;
    font-family: var(--theia-ui-font-family, 'Segoe UI', sans-serif);
    font-size: 18px;
}

/* Edge labels - smaller font for readability */
.sprotty-edge text.sprotty-label {
    font-size: 12px;
}

/* Selection feedback - rect/circle with selected class */
rect.sprotty-node.selected,
circle.sprotty-node.selected,
circle.sprotty-port.selected {
    stroke: var(--theia-focusBorder, #007fd4) !important;
    stroke-width: 2px !important;
}

.sprotty-edge.selected path,
.sprotty-edge.selected line {
    stroke: var(--theia-focusBorder, #007fd4) !important;
    stroke-width: 2px !important;
}

/* Hover feedback */
rect.sprotty-node.mouseover,
circle.sprotty-node.mouseover,
circle.sprotty-port.mouseover {
    stroke: var(--theia-list-hoverForeground, #ffffff);
    filter: brightness(1.1);
}

.sprotty-edge.mouseover path,
.sprotty-edge.mouseover line {
    stroke: var(--theia-list-hoverForeground, #ffffff);
}

/* ============================================
   Sanyam Node Styles
   ============================================ */

.sanyam-node {
    cursor: pointer;
}

.sanyam-node-body {
    fill: var(--theia-editor-background, #1e1e1e);
    stroke: var(--theia-foreground, #cccccc);
    stroke-width: 1px;
}

.sanyam-node.selected .sanyam-node-body {
    stroke: var(--theia-focusBorder, #007fd4);
    stroke-width: 2px;
}

.sanyam-node.mouseover .sanyam-node-body {
    stroke: var(--theia-list-hoverForeground, #ffffff);
}

.sanyam-node-header {
    fill: none;
}

.sanyam-node-header-bg {
    fill: var(--theia-sideBar-background, #252526);
    stroke: none;
}

.sanyam-node-icon {
    font-family: 'codicon';
    font-size: 21px;
    fill: var(--theia-foreground, #cccccc);
    overflow: visible;
}

/* Node type-specific styles */
.sanyam-node-entity .sanyam-node-body {
    fill: var(--theia-textCodeBlock-background, #2d2d30);
}

.sanyam-node-entity .sanyam-node-header-bg {
    fill: var(--theia-activityBar-background, #333333);
}

.sanyam-node-component .sanyam-node-body {
    fill: var(--theia-dropdown-background, #3c3c3c);
}

.sanyam-node-component .sanyam-node-header-bg {
    fill: var(--theia-button-background, #0e639c);
}

.sanyam-node-interface .sanyam-node-body {
    fill: var(--theia-editor-background, #1e1e1e);
    stroke-dasharray: 5, 3;
}

/* ============================================
   Sanyam Edge Styles
   ============================================ */

.sanyam-edge {
    cursor: pointer;
}

.sanyam-edge-path {
    fill: none;
    stroke: var(--theia-foreground, #cccccc);
    stroke-width: 1px;
}

.sanyam-edge.selected .sanyam-edge-path {
    stroke: var(--theia-focusBorder, #007fd4);
    stroke-width: 2px;
}

.sanyam-edge.mouseover .sanyam-edge-path {
    stroke: var(--theia-list-hoverForeground, #ffffff);
}

.sanyam-edge-arrowhead {
    fill: var(--theia-foreground, #cccccc);
    stroke: none;
}

.sanyam-edge.selected .sanyam-edge-arrowhead {
    fill: var(--theia-focusBorder, #007fd4);
}

/* Edge type-specific styles */
.sanyam-edge-path.inheritance {
    stroke-dasharray: none;
}

.sanyam-edge-path.composition {
    stroke-width: 1.5px;
}

.sanyam-edge-path.association {
    stroke-dasharray: 5, 5;
}

/* ============================================
   Sanyam Label Styles
   ============================================ */

.sanyam-label {
    fill: var(--theia-foreground, #cccccc);
    font-family: var(--theia-ui-font-family, 'Segoe UI', sans-serif);
    font-size: 18px;
    pointer-events: none;
}

.sanyam-label-heading {
    font-weight: 600;
    font-size: 21px;
}

/* ============================================
   Sanyam Compartment Styles
   ============================================ */

.sanyam-compartment {
    /* Container styling handled by children */
}

.sanyam-compartment-header {
    font-weight: 600;
}

/* ============================================
   Container Node Styles (Expand/Collapse)
   ============================================ */

/* Container node group */
.sanyam-container-node {
    cursor: pointer;
}

/* Container outer rect - the full body background */
.sanyam-container-body {
    fill: var(--theia-editor-background, #1e1e1e);
    stroke: var(--theia-foreground, #cccccc);
    stroke-width: 1px;
}

/* Container header background - darker shade */
.sanyam-container-header-bg {
    fill: var(--theia-sideBar-background, #252526);
    stroke: none;
}

/* Separator line between header and body */
.sanyam-container-separator {
    stroke: var(--theia-foreground, #cccccc);
    stroke-width: 0.5px;
    opacity: 0.5;
}

/* Selection state for container nodes */
.sanyam-container-node.selected .sanyam-container-body {
    stroke: var(--theia-focusBorder, #007fd4);
    stroke-width: 2px;
}

/* Hover state for container nodes */
.sanyam-container-node.mouseover .sanyam-container-body {
    stroke: var(--theia-list-hoverForeground, #ffffff);
}

/* Collapsed state */
.sanyam-container-node.collapsed .sanyam-container-body {
    opacity: 0.85;
}

/* Expand/collapse button styling */
.sanyam-container-node .sprotty-button {
    cursor: pointer;
}

.sanyam-container-node .sprotty-button rect {
    fill: transparent;
    stroke: none;
}

.sanyam-container-node .sprotty-button text,
.sanyam-container-node .sprotty-button polygon {
    fill: var(--theia-foreground, #cccccc);
}

.sanyam-container-node .sprotty-button:hover text,
.sanyam-container-node .sprotty-button:hover polygon {
    fill: var(--theia-focusBorder, #007fd4);
}

/* Container heading label */
.sanyam-container-node text.sprotty-label {
    font-weight: 600;
    font-size: 14px;
    text-anchor: start !important;
}

/* Container node icon (native SVG paths with per-path fills) */
.sanyam-container-node .sanyam-node-icon {
    overflow: visible;
}

/* Light theme adjustments for container nodes */
.theia-light .sanyam-container-body {
    fill: var(--theia-editor-background, #ffffff);
    stroke: var(--theia-foreground, #616161);
}

.theia-light .sanyam-container-header-bg {
    fill: var(--theia-sideBar-background, #f3f3f3);
}

.theia-light .sanyam-container-separator {
    stroke: var(--theia-foreground, #616161);
}

/* High contrast theme adjustments for container nodes */
.theia-hcDark .sanyam-container-body,
.theia-hcLight .sanyam-container-body {
    stroke-width: 2px;
}

.theia-hcDark .sanyam-container-node.selected .sanyam-container-body,
.theia-hcLight .sanyam-container-node.selected .sanyam-container-body {
    stroke-width: 3px;
}

/* ============================================
   Sprotty Hidden Container
   ============================================ */

.sprotty-hidden {
    position: absolute;
    visibility: hidden;
    left: -10000px;
    top: -10000px;
    width: 1px;
    height: 1px;
    overflow: hidden;
}

/* ============================================
   Sprotty Projection Bars (scroll indicators)
   ============================================ */

.sprotty-projection-bar {
    background-color: var(--theia-scrollbar-shadow, rgba(0, 0, 0, 0.25));
    border-radius: 2px;
}

.sprotty-projection-bar.vertical {
    width: 4px;
}

.sprotty-projection-bar.horizontal {
    height: 4px;
}

/* ============================================
   Sprotty Popup (tooltip)
   ============================================ */

.sprotty-popup {
    background-color: var(--theia-editorWidget-background, #252526);
    border: 1px solid var(--theia-editorWidget-border, #454545);
    border-radius: 3px;
    padding: 8px 12px;
    box-shadow: 0 2px 8px var(--theia-widget-shadow, rgba(0, 0, 0, 0.36));
    font-family: var(--theia-ui-font-family, 'Segoe UI', sans-serif);
    font-size: 12px;
    color: var(--theia-foreground, #cccccc);
    z-index: 1000;
    pointer-events: none;
}

/* ============================================
   Sprotty Command Palette
   ============================================ */

.sprotty-command-palette {
    background-color: var(--theia-quickInput-background, #252526);
    border: 1px solid var(--theia-quickInput-border, #454545);
    border-radius: 4px;
    box-shadow: 0 4px 12px var(--theia-widget-shadow, rgba(0, 0, 0, 0.36));
}

.sprotty-command-palette input {
    background-color: var(--theia-input-background, #3c3c3c);
    border: 1px solid var(--theia-input-border, #3c3c3c);
    color: var(--theia-input-foreground, #cccccc);
}

.sprotty-command-palette input:focus {
    border-color: var(--theia-focusBorder, #007fd4);
    outline: none;
}

/* ============================================
   Light Theme Adjustments
   ============================================ */

.theia-light .sanyam-node-body {
    fill: var(--theia-editor-background, #ffffff);
    stroke: var(--theia-foreground, #616161);
}

.theia-light .sanyam-node-header-bg {
    fill: var(--theia-sideBar-background, #f3f3f3);
}

.theia-light .sanyam-edge-path {
    stroke: var(--theia-foreground, #616161);
}

.theia-light .sanyam-label {
    fill: var(--theia-foreground, #616161);
}

.theia-light .sanyam-edge-arrowhead {
    fill: var(--theia-foreground, #616161);
}

/* ============================================
   High Contrast Theme Adjustments
   ============================================ */

.theia-hcDark .sanyam-node-body,
.theia-hcLight .sanyam-node-body {
    stroke-width: 2px;
}

.theia-hcDark .sanyam-edge-path,
.theia-hcLight .sanyam-edge-path {
    stroke-width: 2px;
}

.theia-hcDark .sanyam-node.selected .sanyam-node-body,
.theia-hcLight .sanyam-node.selected .sanyam-node-body {
    stroke-width: 3px;
}

/* ============================================
   Edge Jumps (Line Bridges)
   ============================================ */

.sanyam-edge-jump {
    fill: none;
    /* stroke inherited from parent edge */
}

/* ============================================
   Animations
   ============================================ */

.sanyam-node,
.sanyam-edge {
    transition: stroke 0.15s ease, fill 0.15s ease, stroke-width 0.15s ease;
}

/* Disable animations when user prefers reduced motion */
@media (prefers-reduced-motion: reduce) {
    .sanyam-node,
    .sanyam-edge {
        transition: none;
    }
}

/* ============================================
   Routing Handles (for edge editing)
   ============================================ */

.sprotty-routing-handle {
    fill: var(--theia-focusBorder, #007fd4);
    stroke: var(--theia-editor-background, #1e1e1e);
    stroke-width: 1px;
    cursor: pointer;
}

.sprotty-routing-handle:hover {
    fill: var(--theia-button-hoverBackground, #1177bb);
}

/* ============================================
   Resize Handles
   ============================================ */

.sprotty-resize-handle {
    fill: var(--theia-focusBorder, #007fd4);
    stroke: var(--theia-editor-background, #1e1e1e);
    stroke-width: 1px;
    cursor: nwse-resize;
}

.sprotty-resize-handle.nw,
.sprotty-resize-handle.se {
    cursor: nwse-resize;
}

.sprotty-resize-handle.ne,
.sprotty-resize-handle.sw {
    cursor: nesw-resize;
}

.sprotty-resize-handle.n,
.sprotty-resize-handle.s {
    cursor: ns-resize;
}

.sprotty-resize-handle.e,
.sprotty-resize-handle.w {
    cursor: ew-resize;
}

/* ============================================
   Tool Palette Integration
   ============================================ */

.sanyam-diagram-tool-palette .sprotty-tool-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    margin: 2px;
    border: none;
    border-radius: 4px;
    background-color: transparent;
    color: var(--theia-foreground, #cccccc);
    cursor: pointer;
}

.sanyam-diagram-tool-palette .sprotty-tool-button:hover {
    background-color: var(--theia-list-hoverBackground, #2a2d2e);
}

.sanyam-diagram-tool-palette .sprotty-tool-button.active {
    background-color: var(--theia-list-activeSelectionBackground, #094771);
    color: var(--theia-list-activeSelectionForeground, #ffffff);
}

/* ============================================
   Connection Preview (for edge creation)
   ============================================ */

.sprotty-edge-creation {
    stroke: var(--theia-focusBorder, #007fd4);
    stroke-dasharray: 5, 5;
    fill: none;
    pointer-events: none;
}

/* ============================================
   Marquee Selection
   ============================================ */

.sprotty-marquee {
    fill: var(--theia-editor-selectionBackground, rgba(38, 79, 120, 0.5));
    stroke: var(--theia-focusBorder, #007fd4);
    stroke-width: 1px;
    stroke-dasharray: 5, 5;
}

/* ============================================
   Sanyam UI Extensions - Tool Palette
   ============================================ */

/* Tool palette container - floats above diagram on the right side */
.sanyam-tool-palette-container,
.sanyam-tool-palette {
    position: absolute;
    right: 10px;
    top: 10px;
    min-width: 180px;
    max-width: 250px;
    max-height: calc(100% - 20px);
    background-color: var(--theia-sideBar-background, #252526);
    border: 1px solid var(--theia-sideBar-border, #454545);
    border-radius: 4px;
    box-shadow: 0 2px 8px var(--theia-widget-shadow, rgba(0, 0, 0, 0.36));
    display: flex;
    flex-direction: column;
    z-index: 100;
    overflow: hidden;
    pointer-events: auto;
}

/* Hidden state for tool palette */
.sanyam-tool-palette.hidden {
    display: none;
}

/* Tool palette close button */
.sanyam-tool-palette-close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    margin-left: auto;
    background: none;
    border: none;
    border-radius: 3px;
    color: var(--theia-foreground, #cccccc);
    cursor: pointer;
    opacity: 0.7;
}

.sanyam-tool-palette-close:hover {
    background-color: var(--theia-list-hoverBackground, #2a2d2e);
    opacity: 1;
}

.sanyam-tool-palette-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 12px;
    background-color: var(--theia-activityBar-background, #333333);
    border-bottom: 1px solid var(--theia-sideBar-border, #454545);
}

.sanyam-tool-palette-title {
    font-weight: 600;
    font-size: 12px;
    color: var(--theia-foreground, #cccccc);
}

.sanyam-tool-palette-collapse {
    background: none;
    border: none;
    color: var(--theia-foreground, #cccccc);
    cursor: pointer;
    padding: 2px;
    border-radius: 3px;
}

.sanyam-tool-palette-collapse:hover {
    background-color: var(--theia-list-hoverBackground, #2a2d2e);
}

.sanyam-tool-palette-search {
    padding: 8px;
    border-bottom: 1px solid var(--theia-sideBar-border, #454545);
}

.sanyam-tool-palette-search input {
    width: 100%;
    padding: 4px 8px;
    background-color: var(--theia-input-background, #3c3c3c);
    border: 1px solid var(--theia-input-border, #3c3c3c);
    border-radius: 3px;
    color: var(--theia-input-foreground, #cccccc);
    font-size: 12px;
}

.sanyam-tool-palette-search input:focus {
    border-color: var(--theia-focusBorder, #007fd4);
    outline: none;
}

.sanyam-tool-palette-content {
    flex: 1;
    overflow-y: auto;
    padding: 4px 0;
}

.sanyam-tool-palette-group {
    margin-bottom: 4px;
}

.sanyam-tool-palette-group-header {
    display: flex;
    align-items: center;
    padding: 6px 12px;
    cursor: pointer;
    user-select: none;
}

.sanyam-tool-palette-group-header:hover {
    background-color: var(--theia-list-hoverBackground, #2a2d2e);
}

.sanyam-tool-palette-group-chevron {
    margin-right: 6px;
    font-size: 10px;
    transition: transform 0.15s ease;
}

.sanyam-tool-palette-group.collapsed .sanyam-tool-palette-group-chevron {
    transform: rotate(-90deg);
}

.sanyam-tool-palette-group-icon {
    margin-right: 6px;
    width: 16px;
    text-align: center;
}

.sanyam-tool-palette-group-label {
    flex: 1;
    font-size: 11px;
    font-weight: 600;
    color: var(--theia-foreground, #cccccc);
    text-transform: uppercase;
}

.sanyam-tool-palette-group-items {
    display: block;
}

.sanyam-tool-palette-group.collapsed .sanyam-tool-palette-group-items {
    display: none;
}

.sanyam-tool-palette-item {
    display: flex;
    align-items: center;
    padding: 4px 12px 4px 32px;
    cursor: pointer;
    user-select: none;
    font-size: 12px;
    color: var(--theia-foreground, #cccccc);
}

.sanyam-tool-palette-item:hover {
    background-color: var(--theia-list-hoverBackground, #2a2d2e);
}

.sanyam-tool-palette-item.selected {
    background-color: var(--theia-list-activeSelectionBackground, #094771);
    color: var(--theia-list-activeSelectionForeground, #ffffff);
}

.sanyam-tool-palette-item-icon {
    margin-right: 8px;
    width: 16px;
    text-align: center;
}

.sanyam-tool-palette-item-label {
    flex: 1;
}

.sanyam-tool-palette-footer {
    padding: 8px;
    border-top: 1px solid var(--theia-sideBar-border, #454545);
}

.sanyam-tool-palette-footer button {
    width: 100%;
    padding: 4px 8px;
    background-color: var(--theia-button-background, #0e639c);
    border: none;
    border-radius: 3px;
    color: var(--theia-button-foreground, #ffffff);
    font-size: 12px;
    cursor: pointer;
}

.sanyam-tool-palette-footer button:hover {
    background-color: var(--theia-button-hoverBackground, #1177bb);
}

/* ============================================
   Sanyam UI Extensions - Validation Markers
   ============================================ */

.sanyam-validation-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 50;
}

/* SVG validation markers */
.sanyam-marker-badge {
    font-family: 'codicon';
    font-size: 12px;
    pointer-events: auto;
    cursor: pointer;
}

.sanyam-marker-badge.error {
    fill: var(--theia-editorError-foreground, #f48771);
}

.sanyam-marker-badge.warning {
    fill: var(--theia-editorWarning-foreground, #cca700);
}

.sanyam-marker-badge.info {
    fill: var(--theia-editorInfo-foreground, #75beff);
}

.sanyam-marker-border.error {
    stroke: var(--theia-editorError-foreground, #f48771);
    stroke-width: 2px;
    fill: none;
}

.sanyam-marker-border.warning {
    stroke: var(--theia-editorWarning-foreground, #cca700);
    stroke-width: 2px;
    fill: none;
}

.sanyam-marker-border.info {
    stroke: var(--theia-editorInfo-foreground, #75beff);
    stroke-width: 2px;
    fill: none;
}

/* ============================================
   Sanyam UI Extensions - Edit Label
   ============================================ */

.sanyam-edit-label-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 200;
}

.sanyam-edit-label-input-container {
    position: absolute;
    pointer-events: auto;
}

.sanyam-edit-label-input {
    padding: 2px 6px;
    background-color: var(--theia-input-background, #3c3c3c);
    border: 1px solid var(--theia-focusBorder, #007fd4);
    border-radius: 2px;
    color: var(--theia-input-foreground, #cccccc);
    font-family: var(--theia-ui-font-family, 'Segoe UI', sans-serif);
    font-size: 12px;
    min-width: 80px;
    outline: none;
    box-shadow: 0 2px 8px var(--theia-widget-shadow, rgba(0, 0, 0, 0.36));
}

.sanyam-edit-label-input.error {
    border-color: var(--theia-inputValidation-errorBorder, #f48771);
}

.sanyam-edit-label-input.warning {
    border-color: var(--theia-inputValidation-warningBorder, #cca700);
}

.sanyam-edit-label-validation {
    position: absolute;
    top: 100%;
    left: 0;
    padding: 4px 8px;
    margin-top: 2px;
    font-size: 11px;
    border-radius: 2px;
    white-space: nowrap;
    z-index: 201;
}

.sanyam-edit-label-validation.error {
    background-color: var(--theia-inputValidation-errorBackground, rgba(244, 135, 113, 0.2));
    border: 1px solid var(--theia-inputValidation-errorBorder, #f48771);
    color: var(--theia-foreground, #cccccc);
}

.sanyam-edit-label-validation.warning {
    background-color: var(--theia-inputValidation-warningBackground, rgba(204, 167, 0, 0.2));
    border: 1px solid var(--theia-inputValidation-warningBorder, #cca700);
    color: var(--theia-foreground, #cccccc);
}

/* ============================================
   Sanyam UI Extensions - Command Palette
   ============================================ */

.sanyam-command-palette-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 300;
}

.sanyam-command-palette {
    position: absolute;
    top: 50px;
    left: 50%;
    transform: translateX(-50%);
    width: 400px;
    max-height: 300px;
    background-color: var(--theia-quickInput-background, #252526);
    border: 1px solid var(--theia-quickInput-border, #454545);
    border-radius: 4px;
    box-shadow: 0 4px 12px var(--theia-widget-shadow, rgba(0, 0, 0, 0.36));
    pointer-events: auto;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.sanyam-command-palette-input-container {
    padding: 8px;
    border-bottom: 1px solid var(--theia-quickInput-border, #454545);
}

.sanyam-command-palette-input {
    width: 100%;
    padding: 6px 10px;
    background-color: var(--theia-input-background, #3c3c3c);
    border: 1px solid var(--theia-input-border, #3c3c3c);
    border-radius: 3px;
    color: var(--theia-input-foreground, #cccccc);
    font-size: 13px;
    outline: none;
}

.sanyam-command-palette-input:focus {
    border-color: var(--theia-focusBorder, #007fd4);
}

.sanyam-command-palette-results {
    flex: 1;
    overflow-y: auto;
    padding: 4px 0;
}

.sanyam-command-palette-item {
    display: flex;
    align-items: center;
    padding: 6px 12px;
    cursor: pointer;
}

.sanyam-command-palette-item:hover,
.sanyam-command-palette-item.focused {
    background-color: var(--theia-list-hoverBackground, #2a2d2e);
}

.sanyam-command-palette-item.selected {
    background-color: var(--theia-list-activeSelectionBackground, #094771);
    color: var(--theia-list-activeSelectionForeground, #ffffff);
}

.sanyam-command-palette-item-icon {
    margin-right: 10px;
    width: 16px;
    text-align: center;
}

.sanyam-command-palette-item-label {
    flex: 1;
    font-size: 13px;
}

.sanyam-command-palette-item-category {
    font-size: 11px;
    color: var(--theia-descriptionForeground, #989898);
    margin-left: 8px;
}

.sanyam-command-palette-empty {
    padding: 16px;
    text-align: center;
    color: var(--theia-descriptionForeground, #989898);
    font-size: 12px;
}

/* ============================================
   Sanyam UI Extensions - Edge Creation
   ============================================ */

.sanyam-edge-creation-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 150;
}

.sanyam-edge-preview {
    stroke: var(--theia-focusBorder, #007fd4);
    stroke-width: 2px;
    stroke-dasharray: 5, 5;
    fill: none;
}

.sanyam-edge-preview-arrowhead {
    fill: var(--theia-focusBorder, #007fd4);
}

/* Valid/Invalid target highlighting */
.sanyam-edge-valid-target {
    stroke: var(--theia-testing-iconPassed, #73c991) !important;
    stroke-width: 3px !important;
}

.sanyam-edge-invalid-target {
    stroke: var(--theia-testing-iconFailed, #f48771) !important;
    stroke-width: 2px !important;
    stroke-dasharray: 3, 3;
}

.sanyam-connection-point {
    fill: var(--theia-focusBorder, #007fd4);
    stroke: var(--theia-editor-background, #1e1e1e);
    stroke-width: 2px;
}

/* ============================================
   Sanyam UI Extensions - Helper Lines
   ============================================ */

.sanyam-helper-lines-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 60;
}

.sanyam-helper-line {
    stroke: var(--theia-editor-lineHighlightBorder, #264f78);
    stroke-width: 1px;
    stroke-dasharray: 4, 4;
}

.sanyam-helper-line.center {
    stroke: var(--theia-focusBorder, #007fd4);
}

.sanyam-helper-line.edge {
    stroke: var(--theia-editor-lineHighlightBorder, #264f78);
}

/* ============================================
   Sanyam UI Extensions - Marquee Selection
   ============================================ */

.sanyam-marquee-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 70;
}

.sanyam-marquee-rect,
.sanyam-marquee-rectangle {
    fill: var(--theia-editor-selectionBackground, rgba(38, 79, 120, 0.3));
    stroke: var(--theia-focusBorder, #007fd4);
    stroke-width: 1px;
    stroke-dasharray: 5, 5;
    /* T025: Ensure proper styling for HTML-based marquee rectangle */
    background-color: var(--theia-editor-selectionBackground, rgba(38, 79, 120, 0.3));
    border: 1px dashed var(--theia-focusBorder, #007fd4);
    box-sizing: border-box;
}

/* ============================================
   Sanyam UI Extensions - Resize Handles
   ============================================ */

.sanyam-resize-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 80;
}

.sanyam-resize-handle {
    fill: var(--theia-focusBorder, #007fd4);
    stroke: var(--theia-editor-background, #1e1e1e);
    stroke-width: 1px;
    pointer-events: auto;
}

.sanyam-resize-handle:hover {
    fill: var(--theia-button-hoverBackground, #1177bb);
}

.sanyam-resize-handle.nw { cursor: nwse-resize; }
.sanyam-resize-handle.n { cursor: ns-resize; }
.sanyam-resize-handle.ne { cursor: nesw-resize; }
.sanyam-resize-handle.e { cursor: ew-resize; }
.sanyam-resize-handle.se { cursor: nwse-resize; }
.sanyam-resize-handle.s { cursor: ns-resize; }
.sanyam-resize-handle.sw { cursor: nesw-resize; }
.sanyam-resize-handle.w { cursor: ew-resize; }

.sanyam-resize-preview {
    fill: none;
    stroke: var(--theia-focusBorder, #007fd4);
    stroke-width: 1px;
    stroke-dasharray: 5, 5;
}

/* ============================================
   Sanyam UI Extensions - Popup/Tooltip
   ============================================ */

.sanyam-popup-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    overflow: visible;
    z-index: 250;
}

.sanyam-popup {
    min-width: 200px;
    max-width: 350px;
    background-color: var(--theia-editorWidget-background, #252526);
    border: 1px solid var(--theia-editorWidget-border, #454545);
    border-radius: 4px;
    box-shadow: 0 2px 8px var(--theia-widget-shadow, rgba(0, 0, 0, 0.36));
    font-size: 12px;
    color: var(--theia-foreground, #cccccc);
    overflow: hidden;
}

.sanyam-popup.pinned {
    border-color: var(--theia-focusBorder, #007fd4);
}

.sanyam-popup-header {
    display: flex;
    align-items: center;
    padding: 8px 12px;
    background-color: var(--theia-activityBar-background, #333333);
    border-bottom: 1px solid var(--theia-editorWidget-border, #454545);
}

.sanyam-popup-icon {
    margin-right: 8px;
    font-size: 14px;
}

.sanyam-popup-title {
    font-weight: 600;
    flex: 1;
}

.sanyam-popup-content {
    padding: 8px 12px;
}

.sanyam-popup-property {
    display: flex;
    margin-bottom: 4px;
}

.sanyam-popup-property-name {
    color: var(--theia-descriptionForeground, #989898);
    margin-right: 8px;
    min-width: 60px;
}

.sanyam-popup-property-value {
    flex: 1;
    word-break: break-word;
}

.sanyam-popup-markers {
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px solid var(--theia-editorWidget-border, #454545);
}

.sanyam-popup-marker {
    display: flex;
    align-items: flex-start;
    padding: 4px 0;
    font-size: 11px;
}

.sanyam-popup-marker::before {
    font-family: 'codicon';
    margin-right: 6px;
    flex-shrink: 0;
}

.sanyam-popup-marker.error::before {
    content: '\eb5d';
    color: var(--theia-editorError-foreground, #f48771);
}

.sanyam-popup-marker.warning::before {
    content: '\ea6c';
    color: var(--theia-editorWarning-foreground, #cca700);
}

.sanyam-popup-marker.info::before {
    content: '\ea74';
    color: var(--theia-editorInfo-foreground, #75beff);
}

.sanyam-popup-actions {
    display: flex;
    gap: 4px;
    padding: 8px 12px;
    border-top: 1px solid var(--theia-editorWidget-border, #454545);
}

.sanyam-popup-action {
    padding: 4px 8px;
    background-color: var(--theia-button-secondaryBackground, #3a3d41);
    border: none;
    border-radius: 3px;
    color: var(--theia-button-secondaryForeground, #cccccc);
    font-size: 11px;
    cursor: pointer;
}

.sanyam-popup-action:hover {
    background-color: var(--theia-button-secondaryHoverBackground, #45494e);
}

/* ============================================
   Sanyam UI Extensions - Minimap
   ============================================ */

.sanyam-minimap-container {
    background-color: var(--theia-minimap-background, rgba(13, 17, 23, 0.75));
    border: 1px solid var(--theia-sideBar-border, #454545);
    border-radius: 4px;
    box-shadow: 0 2px 8px var(--theia-widget-shadow, rgba(0, 0, 0, 0.36));
    overflow: hidden;
    pointer-events: auto;
}

.sanyam-minimap-canvas {
    display: block;
    /* Transparent so the container's semi-transparent background shows through */
    background-color: transparent;
}

.sanyam-minimap-viewport {
    position: absolute;
    border: 1px solid var(--theia-focusBorder, #007fd4);
    background-color: rgba(0, 125, 212, 0.15);
    cursor: move;
    pointer-events: auto;
}

.sanyam-minimap-viewport:hover {
    background-color: rgba(0, 125, 212, 0.25);
}

/* Position classes for minimap */
.sanyam-minimap-container.position-top-left {
    top: 10px;
    left: 10px;
}

.sanyam-minimap-container.position-top-right {
    top: 10px;
    right: 10px;
}

.sanyam-minimap-container.position-bottom-left {
    bottom: 10px;
    left: 10px;
}

.sanyam-minimap-container.position-bottom-right {
    bottom: 10px;
    right: 10px;
}

/* ============================================
   Light Theme Adjustments for UI Extensions
   ============================================ */

.theia-light .sanyam-tool-palette-container,
.theia-light .sanyam-tool-palette {
    background-color: var(--theia-sideBar-background, #f3f3f3);
    border-color: var(--theia-sideBar-border, #e7e7e7);
}

.theia-light .sanyam-command-palette {
    background-color: var(--theia-quickInput-background, #ffffff);
    border-color: var(--theia-quickInput-border, #e0e0e0);
}

.theia-light .sanyam-popup {
    background-color: var(--theia-editorWidget-background, #f3f3f3);
    border-color: var(--theia-editorWidget-border, #c8c8c8);
}

.theia-light .sanyam-minimap-container {
    background-color: var(--theia-minimap-background, rgba(243, 243, 243, 0.9));
    border-color: var(--theia-sideBar-border, #e7e7e7);
}
